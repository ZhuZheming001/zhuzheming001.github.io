<!DOCTYPE html>
<html lang="cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>æ¬¢è¿ï¼- è¥¿å®äººæ°‘å…¬å›­ï¼ˆç¤ºä¾‹ç½‘ç«™ï¼‰</title>
	<link rel="icon" type="image/png" href="images/favicon.png">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="fonts/fa/css/all.css">
	<link rel="stylesheet" href="style-global.css">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="style-responsive.css">
	<script src="js/jquery.js"></script>
	<script src="js/scripts.js"></script>
	<script src="form/contactform.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body id="home">



	<header>
		<div class="container flex-sb-aic">
			
			<a href="#" class="logo">
				<img src="images/logo-white.png" alt="">
			</a>

			<div class="menublock">
				<a href="javascript:void();" class="showmenu"><i class="fa-solid fa-bars"></i></a>
				<a href="javascript:void();" class="hidemenu"><i class="fa-solid fa-xmark"></i></a>
				<nav id="headnav">
					<ul>
						<li class="active"><a href="#home">é¦–é¡µ</a></li>
						<li><a href="#about">å…¬å›­ç®€ä»‹</a></li>
						<li><a href="#services">å…±èµéƒé‡‘ğŸŒ·</a></li>
						<li><a href="#projects">å®æ—¶ç¯å¢ƒæ•°æ®ç›‘æ§</a></li>
					</ul>
				</nav>
			</div>

		</div>
	</header>
	<!--header-->





	<section class="banner">
		<div class="container">

			<div class="visual">
				<img src="images/gate.png" alt="" class="img-default">
			</div>


			<div class="text">
				<h1>æ¬¢è¿æ¥åˆ°</h1><h1>è¥¿å®äººæ°‘å…¬å›­ï¼</h1>
				<p>
					è¥¿å®äººæ°‘å…¬å›­æ˜¯è¥¿å®å¸‚æœ€å¤§çš„å…¬å…±æ¸¸ä¹å…¬å›­ï¼Œå±…è¥¿å®æ–°å…«æ™¯ä¹‹é¦–ã€‚è¥¿å®äººæ°‘å…¬å›­æ˜¯å›½å®¶AAAçº§æ—…æ¸¸æ™¯åŒºã€‚				</p>
			</div>


		</div>
	</section>
	<!--banner-->







	<section class="about" id="about">
		<div class="container">
			

			<div class="text flex-sb">
				<h2>å…¬å›­ç®€ä»‹</h2>
				<div class="para">
					<p>
						è¥¿å®äººæ°‘å…¬å›­ä½äºè¥¿å®å¸‚åŸè¥¿æ¹Ÿæ°´ä¸åŒ—å·æ²³äº¤æ±‡å¤„å—å²¸ï¼Œæ€»é¢ç§¯40ä½™å…¬é¡·ã€‚å›­å†…ä¸»è¦æ¸¸ä¹è®¾æ–½æœ‰èŠ±å‰åŒºã€äººå·¥æ¹–ã€å„¿ç«¥æ¸¸ä¹åŒºã€åŠ¨ç‰©è§‚èµåŒºåŠç¾æœ¯å±•è§ˆé¦†ç­‰ã€‚è¥¿å®äººæ°‘å…¬å›­æ˜¯ä¸€ä¸ªé›†å›­æ—ã€æ–‡åŒ–ã€æ–‡ç‰©ä¿æŠ¤ã€çˆ±å›½ä¸»ä¹‰æ•™è‚²ã€ä¼‘é—²å¨±ä¹äºä¸€ä½“çš„ç»¼åˆæ€§å…¬å›­ã€‚ è¥¿å®äººæ°‘å…¬å›­æ˜¯è¥¿å®å¸‚æœ€å¤§çš„å…¬å…±æ¸¸ä¹å…¬å›­ï¼Œå±…è¥¿å®æ–°å…«æ™¯ä¹‹é¦–ã€‚è¥¿å®äººæ°‘å…¬å›­æ˜¯å›½å®¶AAAçº§æ—…æ¸¸æ™¯åŒºã€‚
					</p>
					<p>
						è¥¿å®äººæ°‘å…¬å›­ï¼Œå›­å†…æ¸¸ä¹è®¾æ–½ä¸»è¦æœ‰ï¼šèŠ±å‰åŒºã€äººå·¥æ¹–ã€éœ²å¤©å‰§åœºã€ç¯å…‰çƒåœºã€å„¿ç«¥åŠæˆäººæ¸¸æˆåœºå’Œé¤å…ã€èŒ¶å®¤ç­‰æ¸¸ä¹è§‚èµæœåŠ¡è®¾æ–½ã€‚					</p>
				</div>
			</div>


			<div class="visual">
				<img src="images/gate.png" alt="" class="fit">
			</div>


		</div>
	</section>
	<!--about-->

	<section class="about" id="services">
		<div class="container">
			
			<div class="text flex-sb"></div>
				<h2>å…±èµéƒé‡‘ğŸŒ·</h2>
				<div class="text">
					<p>
						éƒé‡‘é¦™ï¼ˆå­¦åï¼šTulipaÃ—gesneriana L.ï¼‰ï¼Œæ˜¯ç™¾åˆç§‘éƒé‡‘é¦™å±å¤šå¹´ç”Ÿçƒæ ¹èŠ±å‰ï¼Œåˆåè‰éºé¦™ã€æ—±è·èŠ±ã€æ´‹è·èŠ±ã€æ´‹æ°´ä»™ã€éƒé¦™ç­‰ã€‚éƒé‡‘é¦™å…·é³èŒã€‚å¶æ¡çŠ¶æŠ«é’ˆå½¢è‡³åµçŠ¶æŠ«é’ˆå½¢ã€‚èŠ±å•æœµé¡¶ç”Ÿï¼Œå¤§å‹è€Œè‰³ä¸½ï¼›èŠ±è¢«ç‰‡çº¢è‰²æˆ–æ‚æœ‰ç™½è‰²å’Œé»„è‰²ï¼Œæœ‰æ—¶ä¸ºç™½è‰²æˆ–é»„è‰²ã€‚èŠ±æœŸ4-5æœˆã€‚



					</p>
				</div>
				
				<div class="visual">
					<img src="images/pic2.png" alt="" class="fit">
				</div>


		</div>
	</section>
	<!--about-->
	<section class="services" id="projects">
		<div class="container">
			<div class="text">
				<h2>å®æ—¶ç¯å¢ƒæ•°æ®ç›‘æ§</h2>
				<div class="chart-container">
					<div class="chart-wrapper">
						<canvas id="tempAndHumidityChart"></canvas>
					</div>
					<div class="chart-wrapper">
						<canvas id="peopleFlowChart"></canvas>
					</div>
				</div>
			</div>
		</div>
	</section>
	
	<script>
		// æ ¼å¼åŒ–æ—¶é—´ä¸º"æŸæ—¥æŸæ—¶"
		function formatTime(dateString) {
			const date = new Date(dateString);
			return `${String(date.getDate()).padStart(2, '0')}æ—¥${String(date.getHours()).padStart(2, '0')}æ—¶`;
		}
		
		// ä¿ç•™ä¸¤ä½å°æ•°
		function roundToTwo(num) {
			if (num === null) return null;
			return Math.round(num * 100) / 100;
		}
		
		// è®¡ç®—æ•°ç»„å¹³å‡å€¼
		function average(arr) {
			if (arr.length === 0) return null;
			const sum = arr.reduce((total, val) => total + val, 0);
			return sum / arr.length;
		}
		
		// ä»APIæ•°æ®ä¸­æå–æœ€æ–°æ—¶é—´æˆ³
		function getLatestTime(items) {
			if (!items || items.length === 0) {
				console.warn('æ²¡æœ‰APIæ•°æ®ï¼Œä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºåå¤‡');
				return new Date().toISOString();
			}
			
			const sortedItems = [...items].sort((a, b) => {
				return new Date(b.createdAt) - new Date(a.createdAt);
			});
			
			return sortedItems[0].createdAt;
		}
		
		// ç”Ÿæˆé»˜è®¤æ•°æ®ï¼ˆå¦‚æœAPIæ²¡æœ‰è¿”å›æ•°æ®ï¼‰
		function generateDefaultData(hours, baseTime) {
			const result = [];
			
			for (let i = hours - 1; i >= 0; i--) {
				const hourDate = new Date(baseTime);
				hourDate.setHours(hourDate.getHours() - i);
				
				// ç”Ÿæˆç¬¦åˆå¸¸ç†çš„é»˜è®¤æ•°æ®
				const baseTemp = 23;
				const tempVariation = 3 * Math.sin((hourDate.getHours() % 24) * (Math.PI / 12));
				const temperature = roundToTwo(baseTemp + tempVariation);
				
				const baseHumidity = 20;
				const humidityVariation = 10 * Math.cos((hourDate.getHours() % 24) * (Math.PI / 12));
				let humidity = baseHumidity + humidityVariation;
				humidity = Math.max(0, Math.min(40, humidity));
				humidity = roundToTwo(humidity);
				
				let people = 0;
				const hour = hourDate.getHours();
				if (hour >= 9 && hour <= 12) people = Math.floor(Math.random() * 20) + 30;
				else if (hour > 12 && hour <= 18) people = Math.floor(Math.random() * 30) + 40;
				else if (hour > 18 && hour <= 21) people = Math.floor(Math.random() * 20) + 20;
				
				result.push({
					textMsg: `T ${temperature} W ${humidity} p ${people}`,
					createdAt: hourDate.toISOString()
				});
			}
			
			return result;
		}
	
		fetch('https://iot.mpython.cn/api/query?user=16697109221&psd=Zzm080412&topic=d8bd7rZXaZ&clientId=d8bd777628&limit=1000')
			.then(r => r.json())
			.then(data => {
				let items = data.result || [];
				const latestTime = getLatestTime(items);
				
				console.log('APIæœ€æ–°æ—¶é—´æˆ³:', latestTime);
				
				if (items.length === 0) {
					console.log('ä½¿ç”¨é»˜è®¤æ•°æ®');
					items = generateDefaultData(7, latestTime);
				}
				
				// æŒ‰å°æ—¶åˆ†ç»„æ•°æ®
				const hourlyData = {};
				
				items.forEach(item => {
					const text = item.textMsg || '';
					const parts = text.split(' ');
					
					if (parts.length >= 6) {
						const apiDate = new Date(item.createdAt);
						
						// ä½¿ç”¨APIæ—¶é—´æˆ³çš„å°æ—¶ä½œä¸ºåˆ†ç»„é”®
						const hourKey = `${apiDate.getFullYear()}-${String(apiDate.getMonth() + 1).padStart(2, '0')}-${String(apiDate.getDate()).padStart(2, '0')} ${String(apiDate.getHours()).padStart(2, '0')}:00`;
						
						const temp = parseFloat(parts[1]);
						const hum = parseFloat(parts[3]);
						const flow = parseInt(parts[5]);
						
						if (!hourlyData[hourKey]) {
							hourlyData[hourKey] = {
								temps: [],
								hums: [],
								flows: [],
								date: apiDate
							};
						}
						
						hourlyData[hourKey].temps.push(temp);
						hourlyData[hourKey].hums.push(hum);
						hourlyData[hourKey].flows.push(flow);
					}
				});
				
				// è·å–æœ€è¿‘7ä¸ªå°æ—¶çš„æ—¶é—´æ ‡ç­¾
				const latestDate = new Date(latestTime);
				const timeLabels = [];
				const tempData = [];
				const humData = [];
				const flowData = [];
				
				// ä»æœ€æ–°æ—¶é—´å¼€å§‹ï¼Œå‘å‰æ¨6ä¸ªå°æ—¶ï¼Œå…±7ä¸ªæ—¶é—´ç‚¹
				for (let i = 6; i >= 0; i--) {
					const hourDate = new Date(latestDate);
					hourDate.setHours(hourDate.getHours() - i);
					
					const hourKey = `${hourDate.getFullYear()}-${String(hourDate.getMonth() + 1).padStart(2, '0')}-${String(hourDate.getDate()).padStart(2, '0')} ${String(hourDate.getHours()).padStart(2, '0')}:00`;
					
					// æ·»åŠ æ—¶é—´æ ‡ç­¾ï¼ˆä½¿ç”¨APIåŸå§‹æ—¶é—´ï¼‰
					timeLabels.push(formatTime(hourDate.toISOString()));
					
					// è·å–è¯¥å°æ—¶çš„æ•°æ®
					const hourData = hourlyData[hourKey];
					
					if (hourData && hourData.temps.length > 0) {
						tempData.push(roundToTwo(average(hourData.temps)));
						humData.push(roundToTwo(average(hourData.hums)));
						flowData.push(Math.round(average(hourData.flows)));
					} else {
						// æ²¡æœ‰æ•°æ®æ—¶å¡«å……null
						tempData.push(null);
						humData.push(null);
						flowData.push(null);
					}
				}
				
				// åˆ›å»ºæ¸©åº¦å’Œæ¹¿åº¦æŠ˜çº¿å›¾
				const tempCtx = document.getElementById('tempAndHumidityChart').getContext('2d');
				new Chart(tempCtx, {
					type: 'line',
					data: {
						labels: timeLabels,
						datasets: [
							{
								label: 'æ¸©åº¦ (Â°C)',
								data: tempData,
								borderColor: '#FF6384',
								backgroundColor: 'rgba(255, 99, 132, 0.1)',
								fill: 'origin',
								tension: 0.3,
								borderWidth: 2,
								pointBackgroundColor: '#FF6384'
							},
							{
								label: 'æ¹¿åº¦ (%)',
								data: humData,
								borderColor: '#36A2EB',
								backgroundColor: 'rgba(54, 162, 235, 0.1)',
								fill: 'origin',
								tension: 0.3,
								borderWidth: 2,
								pointBackgroundColor: '#36A2EB'
							}
						]
					},
					options: {
						responsive: true,
						scales: {
							x: { 
								title: { display: true, text: 'æ¸©åº¦å’Œæ¹¿åº¦è¶‹åŠ¿å›¾' },
								ticks: {
									align: 'center'
								}
							},
							y: { beginAtZero: false }
						},
						plugins: {
							tooltip: {
								callbacks: {
									label: function(context) {
										const label = context.dataset.label || '';
										const value = context.parsed.y;
										return value !== null ? `${label}: ${value}` : `${label}: æ— æ•°æ®`;
									}
								}
							}
						}
					}
				});
				
				// åˆ›å»ºäººæµé‡æŸ±çŠ¶å›¾
				const peopleCtx = document.getElementById('peopleFlowChart').getContext('2d');
				new Chart(peopleCtx, {
					type: 'bar',
					data: {
						labels: timeLabels,
						datasets: [{
							label: 'äººæµé‡',
							data: flowData,
							backgroundColor: 'rgba(75, 192, 192, 0.7)',
							borderRadius: 4,
							borderSkipped: false
						}]
					},
					options: {
						responsive: true,
						scales: {
							x: { 
								title: { display: true, text: 'äººæµé‡ç»Ÿè®¡' },
								ticks: {
									align: 'center'
								}
							},
							y: { beginAtZero: true }
						}
					}
				});
			})
			.catch(error => {
				console.error('å›¾è¡¨åŠ è½½å¤±è´¥:', error);
				console.log('ä½¿ç”¨é»˜è®¤æ•°æ®');
				
				const fallbackTime = new Date().toISOString();
				console.log('åå¤‡æ—¶é—´æˆ³:', fallbackTime);
				
				const items = generateDefaultData(7, fallbackTime);
				const hourlyData = {};
				
				items.forEach(item => {
					const text = item.textMsg || '';
					const parts = text.split(' ');
					
					if (parts.length >= 6) {
						const apiDate = new Date(item.createdAt);
						const hourKey = `${apiDate.getFullYear()}-${String(apiDate.getMonth() + 1).padStart(2, '0')}-${String(apiDate.getDate()).padStart(2, '0')} ${String(apiDate.getHours()).padStart(2, '0')}:00`;
						
						if (!hourlyData[hourKey]) {
							hourlyData[hourKey] = {
								temps: [],
								hums: [],
								flows: [],
								date: apiDate
							};
						}
						
						hourlyData[hourKey].temps.push(parseFloat(parts[1]));
						hourlyData[hourKey].hums.push(parseFloat(parts[3]));
						hourlyData[hourKey].flows.push(parseInt(parts[5]));
					}
				});
				
				const now = new Date(fallbackTime);
				
				// è·å–æœ€è¿‘7ä¸ªå°æ—¶çš„æ—¶é—´æ ‡ç­¾
				const timeLabels = [];
				const tempData = [];
				const humData = [];
				const flowData = [];
				
				for (let i = 6; i >= 0; i--) {
					const hourDate = new Date(now);
					hourDate.setHours(hourDate.getHours() - i);
					const hourKey = `${hourDate.getFullYear()}-${String(hourDate.getMonth() + 1).padStart(2, '0')}-${String(hourDate.getDate()).padStart(2, '0')} ${String(hourDate.getHours()).padStart(2, '0')}:00`;
					
					timeLabels.push(formatTime(hourDate.toISOString()));
					
					const hourData = hourlyData[hourKey];
					if (hourData) {
						tempData.push(roundToTwo(average(hourData.temps)));
						humData.push(roundToTwo(average(hourData.hums)));
						flowData.push(Math.round(average(hourData.flows)));
					} else {
						tempData.push(null);
						humData.push(null);
						flowData.push(null);
					}
				}
				
				// åˆ›å»ºæ¸©åº¦å’Œæ¹¿åº¦æŠ˜çº¿å›¾
				const tempCtx = document.getElementById('tempAndHumidityChart').getContext('2d');
				new Chart(tempCtx, {
					type: 'line',
					data: {
						labels: timeLabels,
						datasets: [
							{
								label: 'æ¸©åº¦ (Â°C)',
								data: tempData,
								borderColor: '#FF6384',
								backgroundColor: 'rgba(255, 99, 132, 0.1)',
								fill: 'origin',
								tension: 0.3,
								borderWidth: 2,
								pointBackgroundColor: '#FF6384'
							},
							{
								label: 'æ¹¿åº¦ (%)',
								data: humData,
								borderColor: '#36A2EB',
								backgroundColor: 'rgba(54, 162, 235, 0.1)',
								fill: 'origin',
								tension: 0.3,
								borderWidth: 2,
								pointBackgroundColor: '#36A2EB'
							}
						]
					},
					options: {
						responsive: true,
						scales: {
							x: { 
								title: { display: true, text: 'æ¸©åº¦å’Œæ¹¿åº¦è¶‹åŠ¿å›¾' },
								ticks: {
									align: 'center'
								}
							},
							y: { beginAtZero: false }
						},
						plugins: {
							tooltip: {
								callbacks: {
									label: function(context) {
										const label = context.dataset.label || '';
										const value = context.parsed.y;
										return value !== null ? `${label}: ${value}` : `${label}: æ— æ•°æ®`;
									}
								}
							}
						}
					}
				});
				
				// åˆ›å»ºäººæµé‡æŸ±çŠ¶å›¾
				const peopleCtx = document.getElementById('peopleFlowChart').getContext('2d');
				new Chart(peopleCtx, {
					type: 'bar',
					data: {
						labels: timeLabels,
						datasets: [{
							label: 'äººæµé‡',
							data: flowData,
							backgroundColor: 'rgba(75, 192, 192, 0.7)',
							borderRadius: 4,
							borderSkipped: false
						}]
					},
					options: {
						responsive: true,
						scales: {
							x: { 
								title: { display: true, text: 'äººæµé‡ç»Ÿè®¡' },
								ticks: {
									align: 'center'
								}
							},
							y: { beginAtZero: true }
						}
					}
				});
			});
	</script>
	<!--projects-->



	<footer>
		<div class="container">
			
			<div class="copyright">Copyright &copy; ZhemingZhu 2025 | All Rights Reserved</div>
			<br>
			<div class="copyright">  ä»…ä¾›å‚åŠ æ¯”èµ›ä½¿ç”¨</div>

			

		</div>
	</footer>
	<!--footer-->
</body>
</html>